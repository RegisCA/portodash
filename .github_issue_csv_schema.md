# Optimize historical.csv schema

## Current Schema
```csv
date,account,ticker,shares,cost_basis,price,current_value,portfolio_value,allocation_pct
```

## Problem
Several fields are redundant and can be calculated on-the-fly:
- `cost_basis` - Static value from portfolio.json, doesn't change
- `current_value` - Calculable: `shares Ã— price`
- `portfolio_value` - Calculable: sum of all current_values for that date
- `allocation_pct` - Calculable: `current_value / portfolio_value`

## Proposed Minimal Schema
```csv
date,account,ticker,shares,price
```

## Benefits
1. **Smaller file size** - ~50% reduction
2. **Simpler data model** - Only store what can't be calculated
3. **More flexible** - Can recalculate values with updated logic
4. **Cleaner** - Single source of truth for cost_basis (portfolio.json)

## Considerations
- **Shares tracking**: If user buys/sells holdings, `shares` would change over time
  - Snapshot preserves state at that point in time
  - Could add `shares` to portfolio.json history tracking instead
- **Migration**: Need to convert existing historical.csv files
- **Backward compatibility**: Old format could still be read

## Implementation Plan
1. Create new `save_snapshot_v2()` function with minimal schema
2. Add migration script to convert old format to new
3. Update chart/analysis code to calculate derived values
4. Add config option to choose format (default to new)
5. Deprecate old format in future release

## Alternative: Keep Current Format
If tracking `shares` changes over time is valuable, current format may be optimal.
Need to discuss use cases for historical share quantity tracking.
